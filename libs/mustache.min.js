/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 * mustache.version = "0.8.1";
 */

!function(a,b){if("object"==typeof exports&&exports)b(exports);else{var c={};b(c),"function"==typeof define&&define.amd?define(c):a.Mustache=c}}(this,function(a){function d(a){return"function"==typeof a}function e(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function g(a,b){return f.call(a,b)}function i(a){return!g(h,a)}function k(a){return String(a).replace(/[&<>"'\/]/g,function(a){return j[a]})}function l(a){if(!c(a)||2!==a.length)throw new Error("Invalid tags: "+a);return[new RegExp(e(a[0])+"\\s*"),new RegExp("\\s*"+e(a[1]))]}function r(b,c){function v(){if(k&&!r)for(;j.length;)delete h[j.pop()];else j=[];k=!1,r=!1}if(!b)return[];c=c||a.tags,"string"==typeof c&&(c=c.split(n));for(var w,x,y,z,A,B,d=l(c),f=new u(b),g=[],h=[],j=[],k=!1,r=!1;!f.eos();){if(w=f.pos,y=f.scanUntil(d[0]))for(var C=0,D=y.length;D>C;++C)z=y.charAt(C),i(z)?j.push(h.length):r=!0,h.push(["text",z,w,w+1]),w+=1,"\n"===z&&v();if(!f.scan(d[0]))break;if(k=!0,x=f.scan(q)||"name",f.scan(m),"="===x?(y=f.scanUntil(o),f.scan(o),f.scanUntil(d[1])):"{"===x?(y=f.scanUntil(new RegExp("\\s*"+e("}"+c[1]))),f.scan(p),f.scanUntil(d[1]),x="&"):y=f.scanUntil(d[1]),!f.scan(d[1]))throw new Error("Unclosed tag at "+f.pos);if(A=[x,y,w,f.pos],h.push(A),"#"===x||"^"===x)g.push(A);else if("/"===x){if(B=g.pop(),!B)throw new Error('Unopened section "'+y+'" at '+w);if(B[1]!==y)throw new Error('Unclosed section "'+B[1]+'" at '+w)}else"name"===x||"{"===x||"&"===x?r=!0:"="===x&&(d=l(c=y.split(n)))}if(B=g.pop())throw new Error('Unclosed section "'+B[1]+'" at '+f.pos);return t(s(h))}function s(a){for(var c,d,b=[],e=0,f=a.length;f>e;++e)c=a[e],c&&("text"===c[0]&&d&&"text"===d[0]?(d[1]+=c[1],d[3]=c[3]):(b.push(c),d=c));return b}function t(a){for(var e,f,b=[],c=b,d=[],g=0,h=a.length;h>g;++g)switch(e=a[g],e[0]){case"#":case"^":c.push(e),d.push(e),c=e[4]=[];break;case"/":f=d.pop(),f[5]=e[2],c=d.length>0?d[d.length-1][4]:b;break;default:c.push(e)}return b}function u(a){this.string=a,this.tail=a,this.pos=0}function v(a,b){this.view=null==a?{}:a,this.cache={".":this.view},this.parent=b}function w(){this.cache={}}var b=Object.prototype.toString,c=Array.isArray||function(a){return"[object Array]"===b.call(a)},f=RegExp.prototype.test,h=/\S/,j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},m=/\s*/,n=/\s+/,o=/\s*=/,p=/\s*\}/,q=/#|\^|\/|>|\{|&|=|!/;u.prototype.eos=function(){return""===this.tail},u.prototype.scan=function(a){var b=this.tail.match(a);if(!b||0!==b.index)return"";var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c},u.prototype.scanUntil=function(a){var c,b=this.tail.search(a);switch(b){case-1:c=this.tail,this.tail="";break;case 0:c="";break;default:c=this.tail.substring(0,b),this.tail=this.tail.substring(b)}return this.pos+=c.length,c},v.prototype.push=function(a){return new v(a,this)},v.prototype.lookup=function(a){var b;if(a in this.cache)b=this.cache[a];else{for(var e,f,c=this;c;){if(a.indexOf(".")>0)for(b=c.view,e=a.split("."),f=0;null!=b&&f<e.length;)b=b[e[f++]];else b=c.view[a];if(null!=b)break;c=c.parent}this.cache[a]=b}return d(b)&&(b=b.call(this.view)),b},w.prototype.clearCache=function(){this.cache={}},w.prototype.parse=function(a,b){var c=this.cache,d=c[a];return null==d&&(d=c[a]=r(a,b)),d},w.prototype.render=function(a,b,c){var d=this.parse(a),e=b instanceof v?b:new v(b);return this.renderTokens(d,e,c,a)},w.prototype.renderTokens=function(b,e,f,g){function j(a){return i.render(a,e,f)}for(var k,l,h="",i=this,m=0,n=b.length;n>m;++m)switch(k=b[m],k[0]){case"#":if(l=e.lookup(k[1]),!l)continue;if(c(l))for(var o=0,p=l.length;p>o;++o)h+=this.renderTokens(k[4],e.push(l[o]),f,g);else if("object"==typeof l||"string"==typeof l)h+=this.renderTokens(k[4],e.push(l),f,g);else if(d(l)){if("string"!=typeof g)throw new Error("Cannot use higher-order sections without the original template");l=l.call(e.view,g.slice(k[3],k[5]),j),null!=l&&(h+=l)}else h+=this.renderTokens(k[4],e,f,g);break;case"^":l=e.lookup(k[1]),(!l||c(l)&&0===l.length)&&(h+=this.renderTokens(k[4],e,f,g));break;case">":if(!f)continue;l=d(f)?f(k[1]):f[k[1]],null!=l&&(h+=this.renderTokens(this.parse(l),e,f,l));break;case"&":l=e.lookup(k[1]),null!=l&&(h+=l);break;case"name":l=e.lookup(k[1]),null!=l&&(h+=a.escape(l));break;case"text":h+=k[1]}return h},a.name="mustache.js",a.version="0.8.1",a.tags=["{{","}}"];var x=new w;a.clearCache=function(){return x.clearCache()},a.parse=function(a,b){return x.parse(a,b)},a.render=function(a,b,c){return x.render(a,b,c)},a.to_html=function(b,c,e,f){var g=a.render(b,c,e);return d(f)?(f(g),void 0):g},a.escape=k,a.Scanner=u,a.Context=v,a.Writer=w});